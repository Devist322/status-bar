# Статус-бар виджет для amoCRM

Виджет показывает в карточке сделки полосу 0–1000 и кнопки «+» / «−» для изменения значения. Работает только на фронте, без API и ключей.

## Что в репозитории

- **index.html**, **style.css**, **bar.js** — страница виджета (открывается по ссылке и в iframe).
- **script.js** — JS виджета для amoCRM (формат `define(['jquery'], ...)`, метод `render_template()`).
- **manifest.json** — манифест виджета amoCRM (локации `lcard-1`, `settings`).
- **i18n/ru.json** — тексты для русской локали (название, описание, тур).

## Подключение в amoCRM (загрузка архивом)

В amoCRM виджет подключается **архивом** (ZIP), а не по URL. Ссылка на GitHub Pages нужна только чтобы виджет внутри iframe грузил страницу.

### 1. Подготовка архива

В корне архива должны лежать **сразу** файлы (не папка `status-bar` внутри):

- `manifest.json`
- `script.js`
- папка **i18n** с файлом **ru.json**
- папка **images** с картинками:
  - **logo_min.png** — 84×84 px (иконка в списке виджетов)
  - **logo_medium.png** — 240×84 px (в карточке)
  - **tour_1_ru.png** — любая картинка для тура (например, скрин виджета)

Без этих картинок amoCRM может не принять виджет. Можно сделать минимальные PNG любого содержимого нужного размера.

Пример структуры ZIP:

```
manifest.json
script.js
i18n/
  ru.json
images/
  logo_min.png
  logo_medium.png
  tour_1_ru.png
```

### 2. Загрузка в amoCRM

1. **Настройки** → **Интеграции** → **Добавить интеграцию** / загрузка виджета.
2. Загрузите подготовленный ZIP.
3. Если система выдаст **код виджета** и **секретный ключ** — сохраните их. При следующей загрузке обновлённого виджета их иногда нужно подставлять в manifest (если в вашей версии amoCRM это требуется).
4. Включите виджет в аккаунте.

### 3. Отображение в карточке сделки

- В манифесте указано: **lcard-1** — карточка сделки с правой колонкой виджетов.
- Откройте любую сделку → справа должна появиться панель виджетов с блоком «Статус-бар сделки».
- Внутри блока — iframe с `https://devist322.github.io/status-bar/index.html` (полоса и кнопки «+» / «−»).

Если виджет не виден: проверьте, что виджет включён в настройках интеграции и что в карточке сделки включена правая панель с виджетами.

## Локальный запуск страницы виджета

Чтобы просто открыть страницу с баром (без amoCRM):

```bash
cd /home/haba/Cursor/status-bar
python -m http.server 3000
```

Откройте в браузере: `http://localhost:3000/index.html`

## Документация amoCRM

- [Области подключения виджетов](https://www.amocrm.ru/developers/content/integrations/areas)
- [script.js виджета](https://www.amocrm.ru/developers/content/integrations/script_js)
- [Структура виджета, manifest.json](https://www.amocrm.ru/developers/content/integrations/structure)
